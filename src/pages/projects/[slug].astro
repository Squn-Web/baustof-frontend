---
import AboutSection from "../../components/projects/singleProject/AboutSection.astro";
import CarouselSection from "../../components/projects/singleProject/CarouselSection.astro";
import FeaturedSection from "../../components/projects/singleProject/FeaturedSection.astro";
import SeeMoreSection from "../../components/projects/singleProject/SeeMoreSection.astro";
import StatisticsSection from "../../components/projects/singleProject/StatisticsSection.astro";
import TitleSection from "../../components/projects/singleProject/TitleSection.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { fetchSiteSettings } from "../../api/fetchSiteSettings/query";
import { fetchProjects } from "../../api/projectsPage/fetchProjects/query";
import { fetchProjectBySlug } from "../../api/fetchProjectBySlug/query";

const { slug } = Astro.params;

export async function getStaticPaths() {
  const projects = await fetchProjects();

  return projects.map((project) => ({
    params: { slug: project.slug.current },
  }));
}

const { seo, ...project } = await fetchProjectBySlug(slug);
const siteSettings = await fetchSiteSettings();
const currentPath = Astro.url.pathname;
---

<BaseLayout
  seo={seo}
  siteSettings={siteSettings}
  currentPath={currentPath}
  pageTitle={project.title}
>
  <TitleSection title={project.title} />
  <CarouselSection />
  <AboutSection />
  <StatisticsSection />
  <FeaturedSection />
  <SeeMoreSection />
</BaseLayout>
